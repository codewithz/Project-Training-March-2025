!function(){"use strict";function _sendRequest(method,url,params,jwt){return new Promise(function(resolve,reject){params=params||{},params=Object.assign({},params,{jwt:jwt});var encodedParams=encodeParams(params);"GET"===method&&(url=url+"?"+encodedParams);var req=new XMLHttpRequest;req.open(method,url,!0),req.timeout=4e3,req.setRequestHeader("Content-type","application/x-www-form-urlencoded"),req.addEventListener("load",function(){var statusCode=parseInt(req.status);resolve({text:req.responseText,status:statusCode,ok:statusCode>=200&&statusCode<300})}),req.addEventListener("timeout",function(){resolve({text:"TIMEOUT",status:408,ok:!1})}),req.addEventListener("error",function(e){console.log("ERROR "+e.error),reject(e.error)}),"GET"===method?req.send():req.send(encodedParams)})}var notifier=function(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}(function(module,exports){!function(f){module.exports=f()}(function(){function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function isError(o){return o instanceof Error||/^\[object (Error|(Dom)?Exception)\]$/.test(Object.prototype.toString.call(o))}function throwsMessage(err){return"[Throws: "+(err?err.message:"?")+"]"}function find(haystack,needle){for(var i=0,len=haystack.length;i<len;i++)if(haystack[i]===needle)return!0;return!1}function isDescendent(paths,path){for(var i=0,len=paths.length;i<len;i++)if(0===path.indexOf(paths[i]))return!0;return!1}function shouldRedact(patterns,key){for(var i=0,len=patterns.length;i<len;i++){if("string"==typeof patterns[i]&&patterns[i].toLowerCase()===key.toLowerCase())return!0;if(patterns[i]&&"function"==typeof patterns[i].test&&patterns[i].test(key))return!0}return!1}function __isArray_30(obj){return"[object Array]"===Object.prototype.toString.call(obj)}function safelyGetProp(obj,prop){try{return obj[prop]}catch(err){return throwsMessage(err)}}function prepareObjForSerialization(obj,redactedKeys,redactedPaths){function visit(obj,path){function edgesExceeded(){return path.length>MIN_PRESERVED_DEPTH&&edges>MAX_EDGES}if(edges++,path.length>MAX_DEPTH)return REPLACEMENT_NODE;if(edgesExceeded())return REPLACEMENT_NODE;if(null===obj||"object"!=typeof obj)return obj;if(find(seen,obj))return"[Circular]";if(seen.push(obj),"function"==typeof obj.toJSON)try{edges--;var fResult=visit(obj.toJSON(),path);return seen.pop(),fResult}catch(err){return throwsMessage(err)}if(isError(obj)){edges--;var eResult=visit({name:obj.name,message:obj.message},path);return seen.pop(),eResult}if(__isArray_30(obj)){for(var aResult=[],i=0,len=obj.length;i<len;i++){if(edgesExceeded()){aResult.push(REPLACEMENT_NODE);break}aResult.push(visit(obj[i],path.concat("[]")))}return seen.pop(),aResult}var result={};try{for(var prop in obj)if(Object.prototype.hasOwnProperty.call(obj,prop))if(isDescendent(redactedPaths,path.join("."))&&shouldRedact(redactedKeys,prop))result[prop]="[REDACTED]";else{if(edgesExceeded()){result[prop]=REPLACEMENT_NODE;break}result[prop]=visit(safelyGetProp(obj,prop),path.concat(prop))}}catch(e){}return seen.pop(),result}var seen=[],edges=0;return visit(obj,[])}function add(existingFeatures,existingFeatureKeys,name,variant){if("string"==typeof name){void 0===variant?variant=null:null!==variant&&"string"!=typeof variant&&(variant=_$safeJsonStringify_30(variant));var existingIndex=existingFeatureKeys[name];"number"!=typeof existingIndex?(existingFeatures.push({name:name,variant:variant}),existingFeatureKeys[name]=existingFeatures.length-1):existingFeatures[existingIndex]={name:name,variant:variant}}}function createBugsnagError(errorClass,errorMessage,type,stacktrace){return{errorClass:ensureString(errorClass),errorMessage:ensureString(errorMessage),type:type,stacktrace:_$reduce_17(stacktrace,function(accum,frame){var f=formatStackframe(frame);try{return"{}"===JSON.stringify(f)?accum:accum.concat(f)}catch(e){return accum}},[])}}function getCauseStack(error){return error.cause?[error].concat(getCauseStack(error.cause)):[error]}function randomBlock(){return _$pad_29((Math.random()*discreteValues<<0).toString(base),blockSize)}function safeCounter(){return c=c<discreteValues?c:0,++c-1}function cuid(){return"c"+(new Date).getTime().toString(base)+_$pad_29(safeCounter().toString(base),blockSize)+_$fingerprint_28()+(randomBlock()+randomBlock())}function __randomBlock_41(){return _$pad_43((Math.random()*__discreteValues_41<<0).toString(__base_41),__blockSize_41)}function __safeCounter_41(){return __c_41=__c_41<__discreteValues_41?__c_41:0,++__c_41-1}function __cuid_41(){return"c"+(new Date).getTime().toString(__base_41)+_$pad_43(__safeCounter_41().toString(__base_41),__blockSize_41)+_$fingerprint_42()+(__randomBlock_41()+__randomBlock_41())}function __proxy(host,name,replacer){var original=host[name];if(!original)return original;var replacement=replacer(original);return host[name]=replacement,original}function eventTargetCallbackAccessor(args){var isEventHandlerObj=!!args[1]&&"function"==typeof args[1].handleEvent;return{get:function(){return isEventHandlerObj?args[1].handleEvent:args[1]},replace:function(fn){isEventHandlerObj?args[1].handleEvent=fn:args[1]=fn}}}function getNodeText(el){var text=el.textContent||el.innerText||"";return text||"submit"!==el.type&&"button"!==el.type||(text=el.value),(text=text.replace(trimStart,"").replace(trimEnd,"$1")).length>140?text.slice(0,135)+"(...)":text}function getNodeSelector(el,win){var parts=[el.tagName];if(el.id&&parts.push("#"+el.id),el.className&&el.className.length&&parts.push("."+el.className.split(" ").join(".")),!win.document.querySelectorAll||!Array.prototype.indexOf)return parts.join("");try{if(1===win.document.querySelectorAll(parts.join("")).length)return parts.join("")}catch(e){return parts.join("")}if(el.parentNode.childNodes.length>1){var index=Array.prototype.indexOf.call(el.parentNode.childNodes,el)+1;parts.push(":nth-child("+index+")")}return 1===win.document.querySelectorAll(parts.join("")).length?parts.join(""):el.parentNode?getNodeSelector(el.parentNode,win)+" > "+parts.join(""):parts.join("")}var _$breadcrumbTypes_8=["navigation","request","process","log","user","state","error","manual"],_$reduce_17=function(arr,fn,accum){for(var val=accum,i=0,len=arr.length;i<len;i++)val=fn(val,arr[i],i,arr);return val},_$filter_12=function(arr,fn){return _$reduce_17(arr,function(accum,item,i,arr){return fn(item,i,arr)?accum.concat(item):accum},[])},_$includes_13=function(arr,x){return _$reduce_17(arr,function(accum,item,i,arr){return!0===accum||item===x},!1)},_$isArray_14=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},_hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),_dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],_$keys_15=function(obj){var prop,result=[];for(prop in obj)Object.prototype.hasOwnProperty.call(obj,prop)&&result.push(prop);if(!_hasDontEnumBug)return result;for(var i=0,len=_dontEnums.length;i<len;i++)Object.prototype.hasOwnProperty.call(obj,_dontEnums[i])&&result.push(_dontEnums[i]);return result},_$intRange_24=function(min,max){return void 0===min&&(min=1),void 0===max&&(max=1/0),function(value){return"number"==typeof value&&parseInt(""+value,10)===value&&value>=min&&value<=max}},_$listOfFunctions_25=function(value){return"function"==typeof value||_$isArray_14(value)&&_$filter_12(value,function(f){return"function"==typeof f}).length===value.length},_$stringWithLength_26=function(value){return"string"==typeof value&&!!value.length},_$config_5={};_$config_5.schema={apiKey:{defaultValue:function(){return null},message:"is required",validate:_$stringWithLength_26},appVersion:{defaultValue:function(){},message:"should be a string",validate:function(value){return void 0===value||_$stringWithLength_26(value)}},appType:{defaultValue:function(){},message:"should be a string",validate:function(value){return void 0===value||_$stringWithLength_26(value)}},autoDetectErrors:{defaultValue:function(){return!0},message:"should be true|false",validate:function(value){return!0===value||!1===value}},enabledErrorTypes:{defaultValue:function(){return{unhandledExceptions:!0,unhandledRejections:!0}},message:"should be an object containing the flags { unhandledExceptions:true|false, unhandledRejections:true|false }",allowPartialObject:!0,validate:function(value){if("object"!=typeof value||!value)return!1;var providedKeys=_$keys_15(value),defaultKeys=_$keys_15({unhandledExceptions:!0,unhandledRejections:!0});return!(_$filter_12(providedKeys,function(k){return _$includes_13(defaultKeys,k)}).length<providedKeys.length)&&!(_$filter_12(_$keys_15(value),function(k){return"boolean"!=typeof value[k]}).length>0)}},onError:{defaultValue:function(){return[]},message:"should be a function or array of functions",validate:_$listOfFunctions_25},onSession:{defaultValue:function(){return[]},message:"should be a function or array of functions",validate:_$listOfFunctions_25},onBreadcrumb:{defaultValue:function(){return[]},message:"should be a function or array of functions",validate:_$listOfFunctions_25},endpoints:{defaultValue:function(){return{notify:"https://notify.bugsnag.com",sessions:"https://sessions.bugsnag.com"}},message:"should be an object containing endpoint URLs { notify, sessions }",validate:function(val){return val&&"object"==typeof val&&_$stringWithLength_26(val.notify)&&_$stringWithLength_26(val.sessions)&&0===_$filter_12(_$keys_15(val),function(k){return!_$includes_13(["notify","sessions"],k)}).length}},autoTrackSessions:{defaultValue:function(val){return!0},message:"should be true|false",validate:function(val){return!0===val||!1===val}},enabledReleaseStages:{defaultValue:function(){return null},message:"should be an array of strings",validate:function(value){return null===value||_$isArray_14(value)&&_$filter_12(value,function(f){return"string"==typeof f}).length===value.length}},releaseStage:{defaultValue:function(){return"production"},message:"should be a string",validate:function(value){return"string"==typeof value&&value.length}},maxBreadcrumbs:{defaultValue:function(){return 25},message:"should be a number ≤100",validate:function(value){return _$intRange_24(0,100)(value)}},enabledBreadcrumbTypes:{defaultValue:function(){return _$breadcrumbTypes_8},message:"should be null or a list of available breadcrumb types ("+_$breadcrumbTypes_8.join(",")+")",validate:function(value){return null===value||_$isArray_14(value)&&_$reduce_17(value,function(accum,maybeType){return!1===accum?accum:_$includes_13(_$breadcrumbTypes_8,maybeType)},!0)}},context:{defaultValue:function(){},message:"should be a string",validate:function(value){return void 0===value||"string"==typeof value}},user:{defaultValue:function(){return{}},message:"should be an object with { id, email, name } properties",validate:function(value){return null===value||value&&_$reduce_17(_$keys_15(value),function(accum,key){return accum&&_$includes_13(["id","email","name"],key)},!0)}},metadata:{defaultValue:function(){return{}},message:"should be an object",validate:function(value){return"object"==typeof value&&null!==value}},logger:{defaultValue:function(){},message:"should be null or an object with methods { debug, info, warn, error }",validate:function(value){return!value||value&&_$reduce_17(["debug","info","warn","error"],function(accum,method){return accum&&"function"==typeof value[method]},!0)}},redactedKeys:{defaultValue:function(){return["password"]},message:"should be an array of strings|regexes",validate:function(value){return _$isArray_14(value)&&value.length===_$filter_12(value,function(s){return"string"==typeof s||s&&"function"==typeof s.test}).length}},plugins:{defaultValue:function(){return[]},message:"should be an array of plugin objects",validate:function(value){return _$isArray_14(value)&&value.length===_$filter_12(value,function(p){return p&&"object"==typeof p&&"function"==typeof p.load}).length}},featureFlags:{defaultValue:function(){return[]},message:'should be an array of objects that have a "name" property',validate:function(value){return _$isArray_14(value)&&value.length===_$filter_12(value,function(feature){return feature&&"object"==typeof feature&&"string"==typeof feature.name}).length}}};var _$assign_11=function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_$map_16=function(arr,fn){return _$reduce_17(arr,function(accum,item,i,arr){return accum.concat(fn(item,i,arr))},[])},schema=_$config_5.schema,_$config_1={releaseStage:_$assign_11({},schema.releaseStage,{defaultValue:function(){return/^localhost(:\d+)?$/.test(window.location.host)?"development":"production"}}),appType:_extends({},schema.appType,{defaultValue:function(){return"browser"}}),logger:_$assign_11({},schema.logger,{defaultValue:function(){return"undefined"!=typeof console&&"function"==typeof console.debug?getPrefixedConsole():void 0}})},getPrefixedConsole=function(){var logger={},consoleLog=console.log;return _$map_16(["debug","info","warn","error"],function(method){var consoleMethod=console[method];logger[method]="function"==typeof consoleMethod?consoleMethod.bind(console,"[bugsnag]"):consoleLog.bind(console,"[bugsnag]")}),logger},_$Breadcrumb_3=function(){function Breadcrumb(message,metadata,type,timestamp){void 0===timestamp&&(timestamp=new Date),this.type=type,this.message=message,this.metadata=metadata,this.timestamp=timestamp}return Breadcrumb.prototype.toJSON=function(){return{type:this.type,name:this.message,timestamp:this.timestamp,metaData:this.metadata}},Breadcrumb}(),_$stackframe_34={};!function(root,factory){"object"==typeof _$stackframe_34?_$stackframe_34=factory():root.StackFrame=factory()}(this,function(){function _isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n)}function _capitalize(str){return str.charAt(0).toUpperCase()+str.substring(1)}function _getter(p){return function(){return this[p]}}function StackFrame(obj){if(obj instanceof Object)for(var i=0;i<props.length;i++)obj.hasOwnProperty(props[i])&&void 0!==obj[props[i]]&&this["set"+_capitalize(props[i])](obj[props[i]])}var booleanProps=["isConstructor","isEval","isNative","isToplevel"],numericProps=["columnNumber","lineNumber"],stringProps=["fileName","functionName","source"],arrayProps=["args"],props=booleanProps.concat(numericProps,stringProps,arrayProps);StackFrame.prototype={getArgs:function(){return this.args},setArgs:function(v){if("[object Array]"!==Object.prototype.toString.call(v))throw new TypeError("Args must be an Array");this.args=v},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(v){if(v instanceof StackFrame)this.evalOrigin=v;else{if(!(v instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new StackFrame(v)}},toString:function(){return(this.getFunctionName()||"{anonymous}")+("("+(this.getArgs()||[]).join(",")+")")+(this.getFileName()?"@"+this.getFileName():"")+(_isNumber(this.getLineNumber())?":"+this.getLineNumber():"")+(_isNumber(this.getColumnNumber())?":"+this.getColumnNumber():"")}};for(var i=0;i<booleanProps.length;i++)StackFrame.prototype["get"+_capitalize(booleanProps[i])]=_getter(booleanProps[i]),StackFrame.prototype["set"+_capitalize(booleanProps[i])]=function(p){return function(v){this[p]=Boolean(v)}}(booleanProps[i]);for(var j=0;j<numericProps.length;j++)StackFrame.prototype["get"+_capitalize(numericProps[j])]=_getter(numericProps[j]),StackFrame.prototype["set"+_capitalize(numericProps[j])]=function(p){return function(v){if(!_isNumber(v))throw new TypeError(p+" must be a Number");this[p]=Number(v)}}(numericProps[j]);for(var k=0;k<stringProps.length;k++)StackFrame.prototype["get"+_capitalize(stringProps[k])]=_getter(stringProps[k]),StackFrame.prototype["set"+_capitalize(stringProps[k])]=function(p){return function(v){this[p]=String(v)}}(stringProps[k]);return StackFrame});var _$errorStackParser_31={};!function(root,factory){"object"==typeof _$errorStackParser_31?_$errorStackParser_31=factory(_$stackframe_34):root.ErrorStackParser=factory(root.StackFrame)}(this,function(StackFrame){var FIREFOX_SAFARI_STACK_REGEXP=/(^|@)\S+\:\d+/,CHROME_IE_STACK_REGEXP=/^\s*at .*(\S+\:\d+|\(native\))/m,SAFARI_NATIVE_CODE_REGEXP=/^(eval@)?(\[native code\])?$/;return{parse:function(error){if(void 0!==error.stacktrace||void 0!==error["opera#sourceloc"])return this.parseOpera(error);if(error.stack&&error.stack.match(CHROME_IE_STACK_REGEXP))return this.parseV8OrIE(error);if(error.stack)return this.parseFFOrSafari(error);throw new Error("Cannot parse given Error object")},extractLocation:function(urlLike){if(-1===urlLike.indexOf(":"))return[urlLike];var parts=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(urlLike.replace(/[\(\)]/g,""));return[parts[1],parts[2]||void 0,parts[3]||void 0]},parseV8OrIE:function(error){return error.stack.split("\n").filter(function(line){return!!line.match(CHROME_IE_STACK_REGEXP)},this).map(function(line){line.indexOf("(eval ")>-1&&(line=line.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var sanitizedLine=line.replace(/^\s+/,"").replace(/\(eval code/g,"("),location=sanitizedLine.match(/ (\((.+):(\d+):(\d+)\)$)/),tokens=(sanitizedLine=location?sanitizedLine.replace(location[0],""):sanitizedLine).split(/\s+/).slice(1),locationParts=this.extractLocation(location?location[1]:tokens.pop()),functionName=tokens.join(" ")||void 0,fileName=["eval","<anonymous>"].indexOf(locationParts[0])>-1?void 0:locationParts[0];return new StackFrame({functionName:functionName,fileName:fileName,lineNumber:locationParts[1],columnNumber:locationParts[2],source:line})},this)},parseFFOrSafari:function(error){return error.stack.split("\n").filter(function(line){return!line.match(SAFARI_NATIVE_CODE_REGEXP)},this).map(function(line){if(line.indexOf(" > eval")>-1&&(line=line.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===line.indexOf("@")&&-1===line.indexOf(":"))return new StackFrame({functionName:line});var functionNameRegex=/((.*".+"[^@]*)?[^@]*)(?:@)/,matches=line.match(functionNameRegex),functionName=matches&&matches[1]?matches[1]:void 0,locationParts=this.extractLocation(line.replace(functionNameRegex,""));return new StackFrame({functionName:functionName,fileName:locationParts[0],lineNumber:locationParts[1],columnNumber:locationParts[2],source:line})},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){for(var lineRE=/Line (\d+).*script (?:in )?(\S+)/i,lines=e.message.split("\n"),result=[],i=2,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);match&&result.push(new StackFrame({fileName:match[2],lineNumber:match[1],source:lines[i]}))}return result},parseOpera10:function(e){for(var lineRE=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,lines=e.stacktrace.split("\n"),result=[],i=0,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);match&&result.push(new StackFrame({functionName:match[3]||void 0,fileName:match[2],lineNumber:match[1],source:lines[i]}))}return result},parseOpera11:function(error){return error.stack.split("\n").filter(function(line){return!!line.match(FIREFOX_SAFARI_STACK_REGEXP)&&!line.match(/^Error created at/)},this).map(function(line){var argsRaw,tokens=line.split("@"),locationParts=this.extractLocation(tokens.pop()),functionCall=tokens.shift()||"",functionName=functionCall.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;functionCall.match(/\(([^\)]*)\)/)&&(argsRaw=functionCall.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var args=void 0===argsRaw||"[arguments not available]"===argsRaw?void 0:argsRaw.split(",");return new StackFrame({functionName:functionName,args:args,fileName:locationParts[0],lineNumber:locationParts[1],columnNumber:locationParts[2],source:line})},this)}}});var _$errorStackParser_10=_$errorStackParser_31,_$safeJsonStringify_30=function(data,replacer,space,opts){var redactedKeys=opts&&opts.redactedKeys?opts.redactedKeys:[],redactedPaths=opts&&opts.redactedPaths?opts.redactedPaths:[];return JSON.stringify(prepareObjForSerialization(data,redactedKeys,redactedPaths),replacer,space)},MAX_DEPTH=20,MAX_EDGES=25e3,MIN_PRESERVED_DEPTH=8,REPLACEMENT_NODE="...",_$featureFlagDelegate_18={add:add,clear:function(features,featuresIndex,name){var existingIndex=featuresIndex[name];"number"==typeof existingIndex&&(features[existingIndex]=null,delete featuresIndex[name])},merge:function(existingFeatures,newFeatures,existingFeatureKeys){if(_$isArray_14(newFeatures)){for(var i=0;i<newFeatures.length;++i){var feature=newFeatures[i];null!==feature&&"object"==typeof feature&&add(existingFeatures,existingFeatureKeys,feature.name,feature.variant)}return existingFeatures}},toEventApi:function(featureFlags){return _$map_16(_$filter_12(featureFlags,Boolean),function(_ref){var name=_ref.name,variant=_ref.variant,flag={featureFlag:name};return"string"==typeof variant&&(flag.variant=variant),flag})}},_$hasStack_19=function(err){return!(!err||!err.stack&&!err.stacktrace&&!err["opera#sourceloc"]||"string"!=typeof(err.stack||err.stacktrace||err["opera#sourceloc"])||err.stack===err.name+": "+err.message)},_$iserror_20=function(value){switch(Object.prototype.toString.call(value)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return value instanceof Error}},__clear_22=function(state,section,key){"string"==typeof section&&(key?state[section]&&delete state[section][key]:delete state[section])},_$metadataDelegate_22={add:function(state,section,keyOrObj,maybeVal){var _updates;if(section){var updates;if(null===keyOrObj)return __clear_22(state,section);"object"==typeof keyOrObj&&(updates=keyOrObj),"string"==typeof keyOrObj&&(_updates={},_updates[keyOrObj]=maybeVal,updates=_updates),updates&&(state[section]||(state[section]={}),state[section]=_$assign_11({},state[section],updates))}},get:function(state,section,key){if("string"==typeof section)return key?state[section]?state[section][key]:void 0:state[section]},clear:__clear_22},_$stackGenerator_33={};!function(root,factory){"object"==typeof _$stackGenerator_33?_$stackGenerator_33=factory(_$stackframe_34):root.StackGenerator=factory(root.StackFrame)}(this,function(StackFrame){return{backtrace:function(opts){var stack=[],maxStackSize=10;"object"==typeof opts&&"number"==typeof opts.maxStackSize&&(maxStackSize=opts.maxStackSize);for(var curr=arguments.callee;curr&&stack.length<maxStackSize&&curr.arguments;){for(var args=new Array(curr.arguments.length),i=0;i<args.length;++i)args[i]=curr.arguments[i];/function(?:\s+([\w$]+))+\s*\(/.test(curr.toString())?stack.push(new StackFrame({functionName:RegExp.$1||void 0,args:args})):stack.push(new StackFrame({args:args}));try{curr=curr.caller}catch(e){break}}return stack}}});var Event=function(){function Event(errorClass,errorMessage,stacktrace,handledState,originalError){void 0===stacktrace&&(stacktrace=[]),void 0===handledState&&(handledState=defaultHandledState()),this.apiKey=void 0,this.context=void 0,this.groupingHash=void 0,this.originalError=originalError,this._handledState=handledState,this.severity=this._handledState.severity,this.unhandled=this._handledState.unhandled,this.app={},this.device={},this.request={},this.breadcrumbs=[],this.threads=[],this._metadata={},this._features=[],this._featuresIndex={},this._user={},this._session=void 0,this.errors=[createBugsnagError(errorClass,errorMessage,Event.__type,stacktrace)]}var _proto=Event.prototype;return _proto.addMetadata=function(section,keyOrObj,maybeVal){return _$metadataDelegate_22.add(this._metadata,section,keyOrObj,maybeVal)},_proto.getMetadata=function(section,key){return _$metadataDelegate_22.get(this._metadata,section,key)},_proto.clearMetadata=function(section,key){return _$metadataDelegate_22.clear(this._metadata,section,key)},_proto.addFeatureFlag=function(name,variant){void 0===variant&&(variant=null),_$featureFlagDelegate_18.add(this._features,this._featuresIndex,name,variant)},_proto.addFeatureFlags=function(featureFlags){_$featureFlagDelegate_18.merge(this._features,featureFlags,this._featuresIndex)},_proto.getFeatureFlags=function(){return _$featureFlagDelegate_18.toEventApi(this._features)},_proto.clearFeatureFlag=function(name){_$featureFlagDelegate_18.clear(this._features,this._featuresIndex,name)},_proto.clearFeatureFlags=function(){this._features=[],this._featuresIndex={}},_proto.getUser=function(){return this._user},_proto.setUser=function(id,email,name){this._user={id:id,email:email,name:name}},_proto.toJSON=function(){return{payloadVersion:"4",exceptions:_$map_16(this.errors,function(er){return _$assign_11({},er,{message:er.errorMessage})}),severity:this.severity,unhandled:this._handledState.unhandled,severityReason:this._handledState.severityReason,app:this.app,device:this.device,request:this.request,breadcrumbs:this.breadcrumbs,context:this.context,groupingHash:this.groupingHash,metaData:this._metadata,user:this._user,session:this._session,featureFlags:this.getFeatureFlags()}},Event}(),formatStackframe=function(frame){var f={file:frame.fileName,method:normaliseFunctionName(frame.functionName),lineNumber:frame.lineNumber,columnNumber:frame.columnNumber,code:void 0,inProject:void 0};return f.lineNumber>-1&&!f.file&&!f.method&&(f.file="global code"),f},normaliseFunctionName=function(name){return/^global code$/i.test(name)?"global code":name},defaultHandledState=function(){return{unhandled:!1,severity:"warning",severityReason:{type:"handledException"}}},ensureString=function(str){return"string"==typeof str?str:""};Event.getStacktrace=function(error,errorFramesToSkip,backtraceFramesToSkip){if(_$hasStack_19(error))return _$errorStackParser_10.parse(error).slice(errorFramesToSkip);try{return _$filter_12(_$stackGenerator_33.backtrace(),function(frame){return-1===(frame.functionName||"").indexOf("StackGenerator$$")}).slice(1+backtraceFramesToSkip)}catch(e){return[]}},Event.create=function(maybeError,tolerateNonErrors,handledState,component,errorFramesToSkip,logger){void 0===errorFramesToSkip&&(errorFramesToSkip=0);var event,_normaliseError=normaliseError(maybeError,tolerateNonErrors,component,logger),error=_normaliseError[0],internalFrames=_normaliseError[1];try{var stacktrace=Event.getStacktrace(error,internalFrames>0?1+internalFrames+errorFramesToSkip:0,1+errorFramesToSkip);event=new Event(error.name,error.message,stacktrace,handledState,maybeError)}catch(e){event=new Event(error.name,error.message,[],handledState,maybeError)}if("InvalidError"===error.name&&event.addMetadata(""+component,"non-error parameter",makeSerialisable(maybeError)),error.cause){var _event$errors,causes=getCauseStack(error).slice(1),normalisedCauses=_$map_16(causes,function(cause){var stacktrace=_$iserror_20(cause)&&_$hasStack_19(cause)?_$errorStackParser_10.parse(cause):[],error=normaliseError(cause,!0,"error cause")[0];return"InvalidError"===error.name&&event.addMetadata("error cause",makeSerialisable(cause)),createBugsnagError(error.name,error.message,Event.__type,stacktrace)});(_event$errors=event.errors).push.apply(_event$errors,normalisedCauses)}return event};var makeSerialisable=function(err){return null===err?"null":void 0===err?"undefined":err},normaliseError=function(maybeError,tolerateNonErrors,component,logger){var error,internalFrames=0,createAndLogInputError=function(reason){var verb="error cause"===component?"was":"received";logger&&logger.warn(component+" "+verb+' a non-error: "'+reason+'"');var err=new Error(component+" "+verb+' a non-error. See "'+component+'" tab for more detail.');return err.name="InvalidError",err};if(tolerateNonErrors)switch(typeof maybeError){case"string":case"number":case"boolean":error=new Error(String(maybeError)),internalFrames+=1;break;case"function":error=createAndLogInputError("function"),internalFrames+=2;break;case"object":null!==maybeError&&_$iserror_20(maybeError)?error=maybeError:null!==maybeError&&hasNecessaryFields(maybeError)?((error=new Error(maybeError.message||maybeError.errorMessage)).name=maybeError.name||maybeError.errorClass,internalFrames+=1):(error=createAndLogInputError(null===maybeError?"null":"unsupported object"),internalFrames+=2);break;default:error=createAndLogInputError("nothing"),internalFrames+=2}else _$iserror_20(maybeError)?error=maybeError:(error=createAndLogInputError(typeof maybeError),internalFrames+=2);if(!_$hasStack_19(error))try{throw error}catch(e){_$hasStack_19(e)&&(error=e,internalFrames=1)}return[error,internalFrames]};Event.__type="browserjs";var hasNecessaryFields=function(error){return!("string"!=typeof error.name&&"string"!=typeof error.errorClass||"string"!=typeof error.message&&"string"!=typeof error.errorMessage)},_$Event_6=Event,_$asyncEvery_7=function(arr,fn,cb){var index=0,next=function(){if(index>=arr.length)return cb(null,!0);fn(arr[index],function(err,result){return err?cb(err):!1===result?cb(null,!1):(index++,void next())})};next()},_$callbackRunner_9=function(callbacks,event,onCallbackError,cb){_$asyncEvery_7(callbacks,function(fn,cb){if("function"!=typeof fn)return cb(null);try{if(2!==fn.length){var ret=fn(event);return ret&&"function"==typeof ret.then?ret.then(function(val){return setTimeout(function(){return cb(null,val)})},function(err){setTimeout(function(){return onCallbackError(err),cb(null,!0)})}):cb(null,ret)}fn(event,function(err,result){if(err)return onCallbackError(err),cb(null);cb(null,result)})}catch(e){onCallbackError(e),cb(null)}},cb)},_$syncCallbackRunner_23=function(callbacks,callbackArg,callbackType,logger){for(var ignore=!1,cbs=callbacks.slice();!ignore&&cbs.length;)try{ignore=!1===cbs.pop()(callbackArg)}catch(e){logger.error("Error occurred in "+callbackType+" callback, continuing anyway…"),logger.error(e)}return ignore},_$pad_29=function(num,size){var s="000000000"+num;return s.substr(s.length-size)},env="object"==typeof window?window:self,globalCount=0;for(var prop in env)Object.hasOwnProperty.call(env,prop)&&globalCount++;var mimeTypesLength=navigator.mimeTypes?navigator.mimeTypes.length:0,clientId=_$pad_29((mimeTypesLength+navigator.userAgent.length).toString(36)+globalCount.toString(36),4),_$fingerprint_28=function(){return clientId},c=0,blockSize=4,base=36,discreteValues=Math.pow(base,blockSize);cuid.fingerprint=_$fingerprint_28;var _$cuid_27=cuid,_$Session_35=function(){function Session(){this.id=_$cuid_27(),this.startedAt=new Date,this._handled=0,this._unhandled=0,this._user={},this.app={},this.device={}}var _proto=Session.prototype;return _proto.getUser=function(){return this._user},_proto.setUser=function(id,email,name){this._user={id:id,email:email,name:name}},_proto.toJSON=function(){return{id:this.id,startedAt:this.startedAt,events:{handled:this._handled,unhandled:this._unhandled}}},_proto._track=function(event){this[event._handledState.unhandled?"_unhandled":"_handled"]+=1},Session}(),__add_4=_$featureFlagDelegate_18.add,__clear_4=_$featureFlagDelegate_18.clear,__merge_4=_$featureFlagDelegate_18.merge,noop=function(){},Client=function(){function Client(configuration,schema,internalPlugins,notifier){var _this=this;void 0===schema&&(schema=_$config_5.schema),void 0===internalPlugins&&(internalPlugins=[]),this._notifier=notifier,this._config={},this._schema=schema,this._delivery={sendSession:noop,sendEvent:noop},this._logger={debug:noop,info:noop,warn:noop,error:noop},this._plugins={},this._breadcrumbs=[],this._session=null,this._metadata={},this._featuresIndex={},this._features=[],this._context=void 0,this._user={},this._cbs={e:[],s:[],sp:[],b:[]},this.Client=Client,this.Event=_$Event_6,this.Breadcrumb=_$Breadcrumb_3,this.Session=_$Session_35,this._config=this._configure(configuration,internalPlugins),_$map_16(internalPlugins.concat(this._config.plugins),function(pl){pl&&_this._loadPlugin(pl)}),this._depth=1;var self=this,notify=this.notify;this.notify=function(){return notify.apply(self,arguments)}}var _proto=Client.prototype;return _proto.addMetadata=function(section,keyOrObj,maybeVal){return _$metadataDelegate_22.add(this._metadata,section,keyOrObj,maybeVal)},_proto.getMetadata=function(section,key){return _$metadataDelegate_22.get(this._metadata,section,key)},_proto.clearMetadata=function(section,key){return _$metadataDelegate_22.clear(this._metadata,section,key)},_proto.addFeatureFlag=function(name,variant){void 0===variant&&(variant=null),__add_4(this._features,this._featuresIndex,name,variant)},_proto.addFeatureFlags=function(featureFlags){__merge_4(this._features,featureFlags,this._featuresIndex)},_proto.clearFeatureFlag=function(name){__clear_4(this._features,this._featuresIndex,name)},_proto.clearFeatureFlags=function(){this._features=[],this._featuresIndex={}},_proto.getContext=function(){return this._context},_proto.setContext=function(c){this._context=c},_proto._configure=function(opts,internalPlugins){var schema=_$reduce_17(internalPlugins,function(schema,plugin){return plugin&&plugin.configSchema?_$assign_11({},schema,plugin.configSchema):schema},this._schema),_reduce=_$reduce_17(_$keys_15(schema),function(accum,key){var defaultValue=schema[key].defaultValue(opts[key]);return void 0!==opts[key]?schema[key].validate(opts[key])?schema[key].allowPartialObject?accum.config[key]=_$assign_11(defaultValue,opts[key]):accum.config[key]=opts[key]:(accum.errors[key]=schema[key].message,accum.config[key]=defaultValue):accum.config[key]=defaultValue,accum},{errors:{},config:{}}),errors=_reduce.errors,config=_reduce.config;if(schema.apiKey){if(!config.apiKey)throw new Error("No Bugsnag API Key set");/^[0-9a-f]{32}$/i.test(config.apiKey)||(errors.apiKey="should be a string of 32 hexadecimal characters")}return this._metadata=_$assign_11({},config.metadata),__merge_4(this._features,config.featureFlags,this._featuresIndex),this._user=_$assign_11({},config.user),this._context=config.context,config.logger&&(this._logger=config.logger),config.onError&&(this._cbs.e=this._cbs.e.concat(config.onError)),config.onBreadcrumb&&(this._cbs.b=this._cbs.b.concat(config.onBreadcrumb)),config.onSession&&(this._cbs.s=this._cbs.s.concat(config.onSession)),_$keys_15(errors).length&&this._logger.warn(generateConfigErrorMessage(errors,opts)),config},_proto.getUser=function(){return this._user},_proto.setUser=function(id,email,name){this._user={id:id,email:email,name:name}},_proto._loadPlugin=function(plugin){var result=plugin.load(this);return plugin.name&&(this._plugins["~"+plugin.name+"~"]=result),this},_proto.getPlugin=function(name){return this._plugins["~"+name+"~"]},_proto._setDelivery=function(d){this._delivery=d(this)},_proto.startSession=function(){var session=new _$Session_35;return session.app.releaseStage=this._config.releaseStage,session.app.version=this._config.appVersion,session.app.type=this._config.appType,session._user=_$assign_11({},this._user),_$syncCallbackRunner_23(this._cbs.s,session,"onSession",this._logger)?(this._logger.debug("Session not started due to onSession callback"),this):this._sessionDelegate.startSession(this,session)},_proto.addOnError=function(fn,front){void 0===front&&(front=!1),this._cbs.e[front?"unshift":"push"](fn)},_proto.removeOnError=function(fn){this._cbs.e=_$filter_12(this._cbs.e,function(f){return f!==fn})},_proto._addOnSessionPayload=function(fn){this._cbs.sp.push(fn)},_proto.addOnSession=function(fn){this._cbs.s.push(fn)},_proto.removeOnSession=function(fn){this._cbs.s=_$filter_12(this._cbs.s,function(f){return f!==fn})},_proto.addOnBreadcrumb=function(fn,front){void 0===front&&(front=!1),this._cbs.b[front?"unshift":"push"](fn)},_proto.removeOnBreadcrumb=function(fn){this._cbs.b=_$filter_12(this._cbs.b,function(f){return f!==fn})},_proto.pauseSession=function(){return this._sessionDelegate.pauseSession(this)},_proto.resumeSession=function(){return this._sessionDelegate.resumeSession(this)},_proto.leaveBreadcrumb=function(message,metadata,type){if(message="string"==typeof message?message:"",type="string"==typeof type&&_$includes_13(_$breadcrumbTypes_8,type)?type:"manual",metadata="object"==typeof metadata&&null!==metadata?metadata:{},message){var crumb=new _$Breadcrumb_3(message,metadata,type);_$syncCallbackRunner_23(this._cbs.b,crumb,"onBreadcrumb",this._logger)?this._logger.debug("Breadcrumb not attached due to onBreadcrumb callback"):(this._breadcrumbs.push(crumb),this._breadcrumbs.length>this._config.maxBreadcrumbs&&(this._breadcrumbs=this._breadcrumbs.slice(this._breadcrumbs.length-this._config.maxBreadcrumbs)))}},_proto._isBreadcrumbTypeEnabled=function(type){var types=this._config.enabledBreadcrumbTypes;return null===types||_$includes_13(types,type)},_proto.notify=function(maybeError,onError,postReportCallback){void 0===postReportCallback&&(postReportCallback=noop);var event=_$Event_6.create(maybeError,!0,void 0,"notify()",this._depth+1,this._logger);this._notify(event,onError,postReportCallback)},_proto._notify=function(event,onError,postReportCallback){var _this2=this;if(void 0===postReportCallback&&(postReportCallback=noop),event.app=_$assign_11({},event.app,{releaseStage:this._config.releaseStage,version:this._config.appVersion,type:this._config.appType}),event.context=event.context||this._context,event._metadata=_$assign_11({},event._metadata,this._metadata),event._user=_$assign_11({},event._user,this._user),event.breadcrumbs=this._breadcrumbs.slice(),__merge_4(event._features,this._features,event._featuresIndex),null!==this._config.enabledReleaseStages&&!_$includes_13(this._config.enabledReleaseStages,this._config.releaseStage))return this._logger.warn("Event not sent due to releaseStage/enabledReleaseStages configuration"),postReportCallback(null,event);var originalSeverity=event.severity,onCallbackError=function(err){_this2._logger.error("Error occurred in onError callback, continuing anyway…"),_this2._logger.error(err)},callbacks=[].concat(this._cbs.e).concat(onError);_$callbackRunner_9(callbacks,event,onCallbackError,function(err,shouldSend){if(err&&onCallbackError(err),!shouldSend)return _this2._logger.debug("Event not sent due to onError callback"),postReportCallback(null,event);_this2._isBreadcrumbTypeEnabled("error")&&Client.prototype.leaveBreadcrumb.call(_this2,event.errors[0].errorClass,{errorClass:event.errors[0].errorClass,errorMessage:event.errors[0].errorMessage,severity:event.severity},"error"),originalSeverity!==event.severity&&(event._handledState.severityReason={type:"userCallbackSetSeverity"}),event.unhandled!==event._handledState.unhandled&&(event._handledState.severityReason.unhandledOverridden=!0,event._handledState.unhandled=event.unhandled),_this2._session&&(_this2._session._track(event),event._session=_this2._session),_this2._delivery.sendEvent({apiKey:event.apiKey||_this2._config.apiKey,notifier:_this2._notifier,events:[event]},function(err){return postReportCallback(err,event)})})},Client}(),generateConfigErrorMessage=function(errors,rawInput){return new Error("Invalid configuration\n"+_$map_16(_$keys_15(errors),function(key){return"  - "+key+" "+errors[key]+", got "+stringify(rawInput[key])}).join("\n\n"))},stringify=function(val){switch(typeof val){case"string":case"number":case"object":return JSON.stringify(val);default:return String(val)}},_$Client_4=Client,_$jsonPayload_21={},EVENT_REDACTION_PATHS=["events.[].metaData","events.[].breadcrumbs.[].metaData","events.[].request"];_$jsonPayload_21.event=function(event,redactedKeys){var payload=_$safeJsonStringify_30(event,null,null,{redactedPaths:EVENT_REDACTION_PATHS,redactedKeys:redactedKeys});return payload.length>1e6&&(event.events[0]._metadata={notifier:"WARNING!\nSerialized payload was "+payload.length/1e6+"MB (limit = 1MB)\nmetadata was removed"},payload=_$safeJsonStringify_30(event,null,null,{redactedPaths:EVENT_REDACTION_PATHS,redactedKeys:redactedKeys})),payload},_$jsonPayload_21.session=function(session,redactedKeys){return _$safeJsonStringify_30(session,null,null)};var _$delivery_36={};_$delivery_36=function(client,win){return void 0===win&&(win=window),{sendEvent:function(event,cb){void 0===cb&&(cb=function(){});var url=getApiUrl(client._config,"notify","4",win),body=_$jsonPayload_21.event(event,client._config.redactedKeys),req=new win.XDomainRequest;req.onload=function(){cb(null)},req.onerror=function(){var err=new Error("Event failed to send");client._logger.error("Event failed to send…",err),body.length>1e6&&client._logger.warn("Event oversized ("+(body.length/1e6).toFixed(2)+" MB)"),cb(err)},req.open("POST",url),setTimeout(function(){try{req.send(body)}catch(e){client._logger.error(e),cb(e)}},0)},sendSession:function(session,cb){void 0===cb&&(cb=function(){});var url=getApiUrl(client._config,"sessions","1",win),req=new win.XDomainRequest;req.onload=function(){cb(null)},req.open("POST",url),setTimeout(function(){try{req.send(_$jsonPayload_21.session(session,client._config.redactedKeys))}catch(e){client._logger.error(e),cb(e)}},0)}}};var getApiUrl=function(config,endpoint,version,win){var isoDate=JSON.parse(JSON.stringify(new Date));return matchPageProtocol(config.endpoints[endpoint],win.location.protocol)+"?apiKey="+encodeURIComponent(config.apiKey)+"&payloadVersion="+version+"&sentAt="+encodeURIComponent(isoDate)},matchPageProtocol=_$delivery_36._matchPageProtocol=function(endpoint,pageProtocol){return"http:"===pageProtocol?endpoint.replace(/^https:/,"http:"):endpoint},_$delivery_37=function(client,win){return void 0===win&&(win=window),{sendEvent:function(event,cb){void 0===cb&&(cb=function(){});try{var url=client._config.endpoints.notify,req=new win.XMLHttpRequest,body=_$jsonPayload_21.event(event,client._config.redactedKeys);req.onreadystatechange=function(){if(req.readyState===win.XMLHttpRequest.DONE){var status=req.status;if(0===status||status>=400){var err=new Error("Request failed with status "+status);client._logger.error("Event failed to send…",err),body.length>1e6&&client._logger.warn("Event oversized ("+(body.length/1e6).toFixed(2)+" MB)"),cb(err)}else cb(null)}},req.open("POST",url),req.setRequestHeader("Content-Type","application/json"),req.setRequestHeader("Bugsnag-Api-Key",event.apiKey||client._config.apiKey),req.setRequestHeader("Bugsnag-Payload-Version","4"),req.setRequestHeader("Bugsnag-Sent-At",(new Date).toISOString()),req.send(body)}catch(e){client._logger.error(e)}},sendSession:function(session,cb){void 0===cb&&(cb=function(){});try{var url=client._config.endpoints.sessions,req=new win.XMLHttpRequest;req.onreadystatechange=function(){if(req.readyState===win.XMLHttpRequest.DONE){var status=req.status;if(0===status||status>=400){var err=new Error("Request failed with status "+status);client._logger.error("Session failed to send…",err),cb(err)}else cb(null)}},req.open("POST",url),req.setRequestHeader("Content-Type","application/json"),req.setRequestHeader("Bugsnag-Api-Key",client._config.apiKey),req.setRequestHeader("Bugsnag-Payload-Version","1"),req.setRequestHeader("Bugsnag-Sent-At",(new Date).toISOString()),req.send(_$jsonPayload_21.session(session,client._config.redactedKeys))}catch(e){client._logger.error(e)}}}},appStart=new Date,reset=function(){appStart=new Date},_$app_38={name:"appDuration",load:function(client){return client.addOnError(function(event){var now=new Date;event.app.duration=now-appStart},!0),{reset:reset}}},_$context_39=function(win){return void 0===win&&(win=window),{load:function(client){client.addOnError(function(event){void 0===event.context&&(event.context=win.location.pathname)},!0)}}},_$pad_43=function(num,size){var s="000000000"+num;return s.substr(s.length-size)},__env_42="object"==typeof window?window:self,__globalCount_42=0;for(var __prop_42 in __env_42)Object.hasOwnProperty.call(__env_42,__prop_42)&&__globalCount_42++;var __mimeTypesLength_42=navigator.mimeTypes?navigator.mimeTypes.length:0,__clientId_42=_$pad_43((__mimeTypesLength_42+navigator.userAgent.length).toString(36)+__globalCount_42.toString(36),4),_$fingerprint_42=function(){return __clientId_42},__c_41=0,__blockSize_41=4,__base_41=36,__discreteValues_41=Math.pow(__base_41,__blockSize_41);__cuid_41.fingerprint=_$fingerprint_42;var _$cuid_41=__cuid_41,getDeviceId=function(win){try{var storage=win.localStorage,id=storage.getItem("bugsnag-anonymous-id");return id&&/^c[a-z0-9]{20,32}$/.test(id)?id:(id=_$cuid_41(),storage.setItem("bugsnag-anonymous-id",id),id)}catch(err){}},_$device_40=function(nav,win){return void 0===nav&&(nav=navigator),void 0===win&&(win=window),{load:function(client){var device={locale:nav.browserLanguage||nav.systemLanguage||nav.userLanguage||nav.language,userAgent:nav.userAgent};win&&win.screen&&win.screen.orientation&&win.screen.orientation.type?device.orientation=win.screen.orientation.type:win&&win.document&&(device.orientation=win.document.documentElement.clientWidth>win.document.documentElement.clientHeight?"landscape":"portrait"),client._config.generateAnonymousId&&(device.id=getDeviceId(win)),client.addOnSession(function(session){session.device=_$assign_11({},session.device,device),client._config.collectUserIp||setDefaultUserId(session)}),client.addOnError(function(event){event.device=_$assign_11({},event.device,device,{time:new Date}),client._config.collectUserIp||setDefaultUserId(event)},!0)},configSchema:{generateAnonymousId:{validate:function(value){return!0===value||!1===value},defaultValue:function(){return!0},message:"should be true|false"}}}},setDefaultUserId=function(eventOrSession){var user=eventOrSession.getUser();user&&user.id||eventOrSession.setUser(eventOrSession.device.id)},_$request_44=function(win){return void 0===win&&(win=window),{load:function(client){client.addOnError(function(event){event.request&&event.request.url||(event.request=_$assign_11({},event.request,{url:win.location.href}))},!0)}}},_$session_45={load:function(client){client._sessionDelegate=sessionDelegate}},sessionDelegate={startSession:function(client,session){var sessionClient=client;return sessionClient._session=session,sessionClient._pausedSession=null,null===sessionClient._config.enabledReleaseStages||_$includes_13(sessionClient._config.enabledReleaseStages,sessionClient._config.releaseStage)?(sessionClient._delivery.sendSession({notifier:sessionClient._notifier,device:session.device,app:session.app,sessions:[{id:session.id,startedAt:session.startedAt,user:session._user}]}),sessionClient):(sessionClient._logger.warn("Session not sent due to releaseStage/enabledReleaseStages configuration"),sessionClient)},resumeSession:function(client){return client._session?client:client._pausedSession?(client._session=client._pausedSession,client._pausedSession=null,client):client.startSession()},pauseSession:function(client){client._pausedSession=client._session,client._session=null}},_$clientIp_46={load:function(client){client._config.collectUserIp||client.addOnError(function(event){event._user&&void 0===event._user.id&&delete event._user.id,event._user=_$assign_11({id:"[REDACTED]"},event._user),event.request=_$assign_11({clientIp:"[REDACTED]"},event.request)})},configSchema:{collectUserIp:{defaultValue:function(){return!0},message:"should be true|false",validate:function(value){return!0===value||!1===value}}}},_$consoleBreadcrumbs_47={};_$consoleBreadcrumbs_47.load=function(client){!/^(local-)?dev(elopment)?$/.test(client._config.releaseStage)&&client._isBreadcrumbTypeEnabled("log")&&_$map_16(CONSOLE_LOG_METHODS,function(method){var original=console[method];console[method]=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];client.leaveBreadcrumb("Console output",_$reduce_17(args,function(accum,arg,i){var stringified="[Unknown value]";try{stringified=String(arg)}catch(e){}if("[object Object]"===stringified)try{stringified=JSON.stringify(arg)}catch(e){}return accum["["+i+"]"]=stringified,accum},{severity:0===method.indexOf("group")?"log":method}),"log"),original.apply(console,args)},console[method]._restore=function(){console[method]=original}})};var CONSOLE_LOG_METHODS=_$filter_12(["log","debug","info","warn","error"],function(method){return"undefined"!=typeof console&&"function"==typeof console[method]}),_$inlineScriptContent_48=function(doc,win){return void 0===doc&&(doc=document),void 0===win&&(win=window),{load:function(client){function __traceOriginalScript(fn,callbackAccessor,alsoCallOriginal){return void 0===alsoCallOriginal&&(alsoCallOriginal=!1),function(){var args=[].slice.call(arguments);try{var cba=callbackAccessor(args),cb=cba.get();if(alsoCallOriginal&&fn.apply(this,args),"function"!=typeof cb)return fn.apply(this,args);if(cb.__trace__)cba.replace(cb.__trace__);else{var script=getCurrentScript();cb.__trace__=function(){updateLastScript(script),_setTimeout(function(){updateLastScript(null)},0);var ret=cb.apply(this,arguments);return updateLastScript(null),ret},cb.__trace__.__trace__=cb.__trace__,cba.replace(cb.__trace__)}}catch(e){}if(fn.apply)return fn.apply(this,args);switch(args.length){case 1:return fn(args[0]);case 2:return fn(args[0],args[1]);default:return fn()}}}if(client._config.trackInlineScripts){var originalLocation=win.location.href,html="",DOMContentLoaded=!!doc.attachEvent?"complete"===doc.readyState:"loading"!==doc.readyState,getHtml=function(){return doc.documentElement.outerHTML};html=getHtml();var prev=doc.onreadystatechange;doc.onreadystatechange=function(){"interactive"===doc.readyState&&(html=getHtml(),DOMContentLoaded=!0);try{prev.apply(this,arguments)}catch(e){}};var _lastScript=null,updateLastScript=function(script){_lastScript=script},getCurrentScript=function(){var script=doc.currentScript||_lastScript;if(!script&&!DOMContentLoaded){var scripts=doc.scripts||doc.getElementsByTagName("script");script=scripts[scripts.length-1]}return script},addSurroundingCode=function(lineNumber){DOMContentLoaded&&html||(html=getHtml());var htmlLines=["\x3c!-- DOC START --\x3e"].concat(html.split("\n")),zeroBasedLine=lineNumber-1,start=Math.max(zeroBasedLine-3,0),end=Math.min(zeroBasedLine+3,htmlLines.length);return _$reduce_17(htmlLines.slice(start,end),function(accum,line,i){return accum[start+1+i]=line.length<=200?line:line.substr(0,200),accum},{})};client.addOnError(function(event){event.errors[0].stacktrace=_$filter_12(event.errors[0].stacktrace,function(f){return!/__trace__$/.test(f.method)});var frame=event.errors[0].stacktrace[0],cleanUrl=function(url){return url.replace(/#.*$/,"").replace(/\?.*$/,"")};if(!frame||!frame.file||cleanUrl(frame.file)===cleanUrl(originalLocation)){var currentScript=getCurrentScript();if(currentScript){var content=currentScript.innerHTML;event.addMetadata("script","content",content.length<=5e5?content:content.substr(0,5e5)),frame&&frame.lineNumber&&(frame.code=addSurroundingCode(frame.lineNumber))}}},!0);var _setTimeout=_$map_16(["setTimeout","setInterval","setImmediate","requestAnimationFrame"],function(fn){return __proxy(win,fn,function(original){return __traceOriginalScript(original,function(args){return{get:function(){return args[0]},replace:function(fn){args[0]=fn}}})})})[0];_$map_16(["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],function(o){win[o]&&win[o].prototype&&Object.prototype.hasOwnProperty.call(win[o].prototype,"addEventListener")&&(__proxy(win[o].prototype,"addEventListener",function(original){return __traceOriginalScript(original,eventTargetCallbackAccessor)}),__proxy(win[o].prototype,"removeEventListener",function(original){return __traceOriginalScript(original,eventTargetCallbackAccessor,!0)}))})}},configSchema:{trackInlineScripts:{validate:function(value){return!0===value||!1===value},defaultValue:function(){return!0},message:"should be true|false"}}}},_$interactionBreadcrumbs_49=function(win){return void 0===win&&(win=window),{load:function(client){"addEventListener"in win&&client._isBreadcrumbTypeEnabled("user")&&win.addEventListener("click",function(event){var targetText,targetSelector;try{targetText=getNodeText(event.target),targetSelector=getNodeSelector(event.target,win)}catch(e){targetText="[hidden]",targetSelector="[hidden]",client._logger.error("Cross domain error when tracking click event. See docs: https://tinyurl.com/yy3rn63z")}client.leaveBreadcrumb("UI click",{targetText:targetText,targetSelector:targetSelector},"user")},!0)}}},trimStart=/^\s+/,trimEnd=/(^|[^\s])\s+$/,_$navigationBreadcrumbs_50={};_$navigationBreadcrumbs_50=function(win){return void 0===win&&(win=window),{load:function(client){if("addEventListener"in win&&client._isBreadcrumbTypeEnabled("navigation")){var drop=function(name){return function(){return client.leaveBreadcrumb(name,{},"navigation")}};win.addEventListener("pagehide",drop("Page hidden"),!0),win.addEventListener("pageshow",drop("Page shown"),!0),win.addEventListener("load",drop("Page loaded"),!0),win.document.addEventListener("DOMContentLoaded",drop("DOMContentLoaded"),!0),win.addEventListener("load",function(){return win.addEventListener("popstate",drop("Navigated back"),!0)}),win.addEventListener("hashchange",function(event){var metadata=event.oldURL?{from:relativeLocation(event.oldURL,win),to:relativeLocation(event.newURL,win),state:getCurrentState(win)}:{to:relativeLocation(win.location.href,win)};client.leaveBreadcrumb("Hash changed",metadata,"navigation")},!0),win.history.replaceState&&wrapHistoryFn(client,win.history,"replaceState",win),win.history.pushState&&wrapHistoryFn(client,win.history,"pushState",win)}}}};var relativeLocation=function(url,win){var a=win.document.createElement("A");return a.href=url,""+a.pathname+a.search+a.hash},stateChangeToMetadata=function(win,state,title,url){var currentPath=relativeLocation(win.location.href,win);return{title:title,state:state,prevState:getCurrentState(win),to:url||currentPath,from:currentPath}},wrapHistoryFn=function(client,target,fn,win){var orig=target[fn];target[fn]=function(state,title,url){client.leaveBreadcrumb("History "+fn,stateChangeToMetadata(win,state,title,url),"navigation"),"function"==typeof client.resetEventCount&&client.resetEventCount(),client._config.autoTrackSessions&&client.startSession(),orig.apply(target,[state,title].concat(void 0!==url?url:[]))}},getCurrentState=function(win){try{return win.history.state}catch(e){}},BREADCRUMB_TYPE="request",_$networkBreadcrumbs_51=function(_ignoredUrls,win){return void 0===_ignoredUrls&&(_ignoredUrls=[]),void 0===win&&(win=window),{load:function(client){function handleXHRLoad(method,url,status){if(void 0!==url){if("string"!=typeof url||!_$includes_13(ignoredUrls,url.replace(/\?.*$/,""))){var metadata={status:status,request:method+" "+url};status>=400?client.leaveBreadcrumb("XMLHttpRequest failed",metadata,BREADCRUMB_TYPE):client.leaveBreadcrumb("XMLHttpRequest succeeded",metadata,BREADCRUMB_TYPE)}}else client._logger.warn("The request URL is no longer present on this XMLHttpRequest. A breadcrumb cannot be left for this request.")}function handleXHRError(method,url){void 0!==url?"string"==typeof url&&_$includes_13(ignoredUrls,url.replace(/\?.*$/,""))||client.leaveBreadcrumb("XMLHttpRequest error",{request:method+" "+url},BREADCRUMB_TYPE):client._logger.warn("The request URL is no longer present on this XMLHttpRequest. A breadcrumb cannot be left for this request.")}if(client._isBreadcrumbTypeEnabled("request")){var ignoredUrls=[client._config.endpoints.notify,client._config.endpoints.sessions].concat(_ignoredUrls);!function(){if("addEventListener"in win.XMLHttpRequest.prototype){var nativeOpen=win.XMLHttpRequest.prototype.open;win.XMLHttpRequest.prototype.open=function(method,url){var _this=this,requestSetupKey=!1,error=function(){return handleXHRError(method,url)},load=function(){return handleXHRLoad(method,url,_this.status)};requestSetupKey&&(this.removeEventListener("load",load),this.removeEventListener("error",error)),this.addEventListener("load",load),this.addEventListener("error",error),requestSetupKey=!0,nativeOpen.apply(this,arguments)}}}(),function(){if("fetch"in win&&!win.fetch.polyfill){var oldFetch=win.fetch;win.fetch=function(){var method,_arguments=arguments,urlOrRequest=arguments[0],options=arguments[1],url=null;return urlOrRequest&&"object"==typeof urlOrRequest?(url=urlOrRequest.url,options&&"method"in options?method=options.method:urlOrRequest&&"method"in urlOrRequest&&(method=urlOrRequest.method)):(url=urlOrRequest,options&&"method"in options&&(method=options.method)),void 0===method&&(method="GET"),new Promise(function(resolve,reject){oldFetch.apply(void 0,_arguments).then(function(response){handleFetchSuccess(response,method,url),resolve(response)}).catch(function(error){handleFetchError(method,url),reject(error)})})}}}();var handleFetchSuccess=function(response,method,url){var metadata={status:response.status,request:method+" "+url};response.status>=400?client.leaveBreadcrumb("fetch() failed",metadata,BREADCRUMB_TYPE):client.leaveBreadcrumb("fetch() succeeded",metadata,BREADCRUMB_TYPE)},handleFetchError=function(method,url){client.leaveBreadcrumb("fetch() error",{request:method+" "+url},BREADCRUMB_TYPE)}}}}},_$throttle_52={load:function(client){var n=0;client.addOnError(function(event){if(n>=client._config.maxEvents)return client._logger.warn("Cancelling event send due to maxEvents per session limit of "+client._config.maxEvents+" being reached"),!1;n++}),client.resetEventCount=function(){n=0}},configSchema:{maxEvents:{defaultValue:function(){return 10},message:"should be a positive integer ≤100",validate:function(val){return _$intRange_24(1,100)(val)}}}},_$stripQueryString_53={},strip=(_$stripQueryString_53={load:function(client){client.addOnError(function(event){var allFrames=_$reduce_17(event.errors,function(accum,er){return accum.concat(er.stacktrace)},[]);_$map_16(allFrames,function(frame){frame.file=strip(frame.file)})})}})._strip=function(str){return"string"==typeof str?str.replace(/\?.*$/,"").replace(/#.*$/,""):str},_$onerror_54=function(win,component){return void 0===win&&(win=window),void 0===component&&(component="window onerror"),{load:function(client){if(client._config.autoDetectErrors&&client._config.enabledErrorTypes.unhandledExceptions){var prevOnError=win.onerror;win.onerror=function(messageOrEvent,url,lineNo,charNo,error){if(0===lineNo&&/Script error\.?/.test(messageOrEvent))client._logger.warn("Ignoring cross-domain or eval script error. See docs: https://tinyurl.com/yy3rn63z");else{var event,handledState={severity:"error",unhandled:!0,severityReason:{type:"unhandledException"}};if(error)event=client.Event.create(error,!0,handledState,component,1),decorateStack(event.errors[0].stacktrace,url,lineNo,charNo);else if("object"!=typeof messageOrEvent||null===messageOrEvent||url&&"string"==typeof url||lineNo||charNo||error)event=client.Event.create(messageOrEvent,!0,handledState,component,1),decorateStack(event.errors[0].stacktrace,url,lineNo,charNo);else{var name=messageOrEvent.type?"Event: "+messageOrEvent.type:"Error",message=messageOrEvent.message||messageOrEvent.detail||"";(event=client.Event.create({name:name,message:message},!0,handledState,component,1)).originalError=messageOrEvent,event.addMetadata(component,{event:messageOrEvent,extraParameters:url})}client._notify(event)}"function"==typeof prevOnError&&prevOnError.apply(this,arguments)}}}}},decorateStack=function(stack,url,lineNo,charNo){stack[0]||stack.push({});var culprit=stack[0];culprit.file||"string"!=typeof url||(culprit.file=url),!culprit.lineNumber&&isActualNumber(lineNo)&&(culprit.lineNumber=lineNo),culprit.columnNumber||(isActualNumber(charNo)?culprit.columnNumber=charNo:window.event&&isActualNumber(window.event.errorCharacter)&&(culprit.columnNumber=window.event.errorCharacter))},isActualNumber=function(n){return"number"==typeof n&&"NaN"!==String.call(n)},_$unhandledRejection_55=function(win){return void 0===win&&(win=window),{load:function(client){if(client._config.autoDetectErrors&&client._config.enabledErrorTypes.unhandledRejections){var listener=function(evt){var error=evt.reason,isBluebird=!1;try{evt.detail&&evt.detail.reason&&(error=evt.detail.reason,isBluebird=!0)}catch(e){}var event=client.Event.create(error,!1,{severity:"error",unhandled:!0,severityReason:{type:"unhandledPromiseRejection"}},"unhandledrejection handler",1,client._logger);isBluebird&&_$map_16(event.errors[0].stacktrace,fixBluebirdStacktrace(error)),client._notify(event,function(event){if(_$iserror_20(event.originalError)&&!event.originalError.stack){var _event$addMetadata;event.addMetadata("unhandledRejection handler",(_event$addMetadata={},_event$addMetadata[Object.prototype.toString.call(event.originalError)]={name:event.originalError.name,message:event.originalError.message,code:event.originalError.code},_event$addMetadata))}})};"addEventListener"in win?win.addEventListener("unhandledrejection",listener):win.onunhandledrejection=function(reason,promise){listener({detail:{reason:reason,promise:promise}})}}}}},fixBluebirdStacktrace=function(error){return function(frame){frame.file!==error.toString()&&frame.method&&(frame.method=frame.method.replace(/^\s+/,""))}},_$notifier_2={},__schema_2=_$assign_11({},_$config_5.schema,_$config_1),Bugsnag={_client:null,createClient:function(opts){"string"==typeof opts&&(opts={apiKey:opts}),opts||(opts={});var internalPlugins=[_$app_38,_$device_40(),_$context_39(),_$request_44(),_$throttle_52,_$session_45,_$clientIp_46,_$stripQueryString_53,_$onerror_54(),_$unhandledRejection_55(),_$navigationBreadcrumbs_50(),_$interactionBreadcrumbs_49(),_$networkBreadcrumbs_51(),_$consoleBreadcrumbs_47,_$inlineScriptContent_48()],bugsnag=new _$Client_4(opts,__schema_2,internalPlugins,{name:"Bugsnag JavaScript",version:"7.20.2",url:"https://github.com/bugsnag/bugsnag-js"});return bugsnag._setDelivery(window.XDomainRequest?_$delivery_36:_$delivery_37),bugsnag._logger.debug("Loaded!"),bugsnag.leaveBreadcrumb("Bugsnag loaded",{},"state"),bugsnag._config.autoTrackSessions?bugsnag.startSession():bugsnag},start:function(opts){return Bugsnag._client?(Bugsnag._client._logger.warn("Bugsnag.start() was called more than once. Ignoring."),Bugsnag._client):(Bugsnag._client=Bugsnag.createClient(opts),Bugsnag._client)},isStarted:function(){return null!=Bugsnag._client}};return _$map_16(["resetEventCount"].concat(_$keys_15(_$Client_4.prototype)),function(m){/^_/.test(m)||(Bugsnag[m]=function(){if(!Bugsnag._client)return console.log("Bugsnag."+m+"() was called before Bugsnag.start()");Bugsnag._client._depth+=1;var ret=Bugsnag._client[m].apply(Bugsnag._client,arguments);return Bugsnag._client._depth-=1,ret})}),_$notifier_2=Bugsnag,_$notifier_2.Client=_$Client_4,_$notifier_2.Event=_$Event_6,_$notifier_2.Session=_$Session_35,_$notifier_2.Breadcrumb=_$Breadcrumb_3,_$notifier_2.default=Bugsnag,_$notifier_2})});notifier.start({apiKey:"6bb45accdcbaa8e6f1438cc4eacaf241",onError:function(event){var errors=event.errors;if(errors.length){var err=errors[0],errorClass=err.errorClass,errorMessage=err.errorMessage;if(errorClass&&("PostMessageIO:NotHandled"===errorClass||"PostMessageIO:PluginDisabled"===errorClass))return!1;if(errorMessage&&errorMessage.startsWith("PluginData length of 4096 characters exceeded"))return!1}}});var bugsnagClient={notify:function(e){notifier.notify(e)}},SERVER_URL="https://app.timeinlist.com",loadingPromise=void 0,noLocalStorageStatusCache=void 0,getStatus=function(t){var noCache=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t.isMemberSignedIn())return Promise.resolve({});var cacheKey="status_"+t.getContext().board+"_"+t.getContext().member,statusCache=void 0;try{statusCache=window.localStorage[cacheKey]?JSON.parse(window.localStorage[cacheKey]):void 0}catch(error){statusCache=noLocalStorageStatusCache}return noCache=noCache||statusCache&&(!statusCache.loaded||statusCache.loaded<(new Date).getTime()-6e5),loadingPromise||(!statusCache||noCache?loadingPromise=sendRequest(t,"GET",SERVER_URL+"/Authorisation/status").then(function(resp){return JSON.parse(resp.text)}).then(function(status){status.loaded=(new Date).getTime();try{window.localStorage[cacheKey]=JSON.stringify(status)}catch(error){noLocalStorageStatusCache=status}return status}).catch(function(e){return{}}).finally(function(){loadingPromise=null}).catch(function(e){bugsnagClient.notify(e),loadingPromise=null}):Promise.resolve(statusCache))},encodeParams=function(params){return Object.keys(params).reduce(function(acc,k){var val=params[k];if(val){var _encoded=encodeURIComponent(k)+"="+encodeURIComponent(val);acc.push(_encoded)}return acc},[]).join("&")},sendRequest=function(t,method,url,params){return t.jwt().then(function(jwt){return _sendRequest(method,url,params,jwt)})},sendRequestWithoutJWT=function(method,url,params){return _sendRequest(method,url,params)},findIndex=function(array,predicate,thisArg){if(Array.prototype.findIndex)return Array.prototype.findIndex.call(array,predicate);for(var len=array.length>>>0,k=0;k<len;){var kValue=array[k];if(predicate.call(thisArg,kValue,k,array))return k;k++}return-1},DAY=864e5,TIME_FROM_LARGEST=[31536e6,2628e6,6048e5,DAY,36e5,6e4,1e3],NAMES_FROM_LARGEST=["year","month","week","day","hour","minute","second"],formatTime=function(ms){if(ms<1e3)return"1 second";var smallerIdx=findIndex(TIME_FROM_LARGEST,function(t){return t<ms}),unit=TIME_FROM_LARGEST[smallerIdx],unitName=NAMES_FROM_LARGEST[smallerIdx],val=Math.round(ms/unit);return val+" "+unitName+(1===val?"":"s")},isWeekendDay=function(time,weekendMode){var day=new Date(time).getDay();return"FRISAT"===weekendMode&&(5==day||6==day)||"SATSUN"===weekendMode&&(6==day||0===day)},getDuration=function(start,end,weekendMode){var duration=void 0;if(start=+start,end=+end,"SHOW"==(weekendMode=weekendMode||"SHOW"))duration=end-start;else if(isWeekendDay(start,weekendMode)||isWeekendDay(end,weekendMode)){if(isWeekendDay(start,weekendMode)){var weekStartDate=new Date(start+DAY);weekStartDate.setHours(0,0,0,0);for(var weekStart=weekStartDate.getTime();isWeekendDay(weekStart,weekendMode);)weekStart+=DAY;start=weekStart}if(isWeekendDay(end,weekendMode)){var weekEndDate=new Date(end-DAY);weekEndDate.setHours(23,59,59,999);for(var weekEnd=weekEndDate.getTime();isWeekendDay(weekEnd,weekendMode);)weekEnd-=DAY;end=weekEnd+1}duration=end-start,duration-=2*Math.floor(duration/6048e5)*DAY}else if((duration=end-start)>DAY){duration-=2*Math.floor(duration/6048e5)*DAY;var startDay=new Date(start).getDay(),endDay=new Date(end).getDay();endDay<=startDay&&(endDay+=7);for(var i=startDay;i<endDay;i++){var currDay=i<7?i:i-7;"FRISAT"!==weekendMode||5!=currDay&&6!=currDay?"SATSUN"!==weekendMode||6!=currDay&&0!==currDay||(duration-=864e5):duration-=864e5}}return duration},Promise$1=TrelloPowerUp.Promise,getCardTimeFromPowerupData=function(t,cardId){return t.get(cardId,"shared","timeInListDataVersion",null).then(function(dataVersion){return 1!==dataVersion?null:t.get(cardId,"shared","timesByListCardId",null).then(function(tilCardId){return tilCardId==cardId?t.get(cardId,"shared","timesByList",null):Promise$1.resolve(null)}).catch(function(e){bugsnagClient.notify(e)})})},getCardTimeFromServer=function(cardId,listId,boardId,loadBackTo){return sendRequestWithoutJWT("GET",SERVER_URL+"/TimeInList/"+boardId+"/"+listId+"/"+cardId,{loadBackTo:loadBackTo}).then(function(resp){if(resp.status>=200&&resp.status<300){var respJson=JSON.parse(resp.text);return respJson.success?respJson:new Error("Tracking not enabled for this board")}if(404!==resp.status&&408!==resp.status)throw new Error("Time In List request failed: "+resp.status)})},getLatestListEntry=function(cardTimesByList){for(var ret={},mostRecentTime=void 0,mostRecentList=void 0,i=Object.keys(cardTimesByList).length-1;i>=0;i--)for(var listId=Object.keys(cardTimesByList)[i],j=Object.keys(cardTimesByList[listId]).length-1;j>=0;j--){var enteredTime=Object.keys(cardTimesByList[listId])[j];(!mostRecentTime||enteredTime>mostRecentTime)&&(mostRecentTime=enteredTime,mostRecentList=listId)}return ret[mostRecentList]=mostRecentTime,ret},getLatestEntryTime=function(cardTimesByList){var latest=getLatestListEntry(cardTimesByList);return latest?latest[Object.keys(latest)[0]]:null},asyncSaveCardTimeInList=function(t,cardId,cardTimesByList){return t.get(cardId,"shared","timesByListCardId",null).then(function(tilCardId){return tilCardId==cardId?t.get(cardId,"shared","timesByList",{}).then(function(localTimesByList){return createLocalTimeInList(t,cardId,cardTimesByList,localTimesByList)}):createLocalTimeInList(t,cardId,cardTimesByList,{})})},createLocalTimeInList=function(t,cardId,cardTimesByList,localTimesByList){return t.get(cardId,"shared","timeInListDataVersion",null).then(function(dataVersion){1!==dataVersion&&(localTimesByList={});for(var i=Object.keys(cardTimesByList).length-1;i>=0;i--){var listId=Object.keys(cardTimesByList)[i];localTimesByList[listId]||(localTimesByList[listId]={});for(var j=Object.keys(cardTimesByList[listId]).length-1;j>=0;j--){var enteredTime=Object.keys(cardTimesByList[listId])[j];localTimesByList[listId][enteredTime]||(localTimesByList[listId][enteredTime]=cardTimesByList[listId][enteredTime])}}return t.set(cardId,"shared",{timesByList:localTimesByList,timesByListCardId:cardId,timeInListDataVersion:1})})},getCardTimeInList=function(cardId,listId,boardId,t){return getCardTimeFromPowerupData(t,cardId).then(function(cardTimesByList){return cardTimesByList&&getLatestListEntry(cardTimesByList)[listId]?getLatestListEntry(cardTimesByList):getStatus(t).then(function(status){if(status.boardTracked&&(status.subscriptionActive||status.trialActive)){var loadBackTo=cardTimesByList?getLatestEntryTime(cardTimesByList):null;return getCardTimeFromServer(cardId,listId,boardId,loadBackTo).then(function(response){return response&&response.loaded?(asyncSaveCardTimeInList(t,cardId,response.cardTimesByList),getLatestListEntry(response.cardTimesByList)):void 0})}})}).then(function(cardTimeEnteredList){return t.get("board","shared","weekendMode","SHOW").then(function(weekendMode){return cardTimeEnteredList&&cardTimeEnteredList[listId]?getDuration(cardTimeEnteredList[listId],(new Date).getTime(),weekendMode):null})}).catch(function(e){bugsnagClient.notify(e)})},Promise$2=TrelloPowerUp.Promise,getCardTimeFromPowerupData$1=function(t,cardId){return t.get(cardId,"shared","timeOnBoardDataVersion",null).then(function(dataVersion){return 1!==dataVersion?null:t.get(cardId,"shared","timesOnBoardCardId",null).then(function(tilCardId){return tilCardId==cardId?t.get(cardId,"shared","timeOnBoard",null):Promise$2.resolve(null)}).catch(function(e){bugsnagClient.notify(e)})})},getCardTimeFromServer$1=function(cardId,boardId){return sendRequestWithoutJWT("GET",SERVER_URL+"/TimeOnBoard/"+boardId+"/"+cardId).then(function(resp){if(resp.status>=200&&resp.status<300){var respJson=JSON.parse(resp.text);return respJson.success?respJson:new Error("Tracking not enabled for this board")}if(404!==resp.status&&408!==resp.status)throw new Error("Time On Board request failed: "+resp.status)}).catch(function(e){bugsnagClient.notify(e)})},getLatestBoardEntry=function(timesByBoard){for(var ret={},mostRecentTime=void 0,mostRecentBoard=void 0,i=Object.keys(timesByBoard).length-1;i>=0;i--)for(var boardId=Object.keys(timesByBoard)[i],j=Object.keys(timesByBoard[boardId]).length-1;j>=0;j--){var enteredTime=Object.keys(timesByBoard[boardId])[j];(!mostRecentTime||enteredTime>mostRecentTime)&&(mostRecentTime=enteredTime,mostRecentBoard=boardId)}return ret[mostRecentBoard]=mostRecentTime,ret},asyncSaveCardTimeOnBoard=function(t,cardId,timesByBoard){return t.get(cardId,"shared","timesOnBoardCardId",null).then(function(tilCardId){return tilCardId==cardId?t.get(cardId,"shared","timeOnBoard",{}).then(function(localTimesByBoard){return createLocalTimeByBoard(t,cardId,timesByBoard,localTimesByBoard)}):createLocalTimeByBoard(t,cardId,timesByBoard,{})})},createLocalTimeByBoard=function(t,cardId,timesByBoard,localTimesByBoard){return t.get(cardId,"shared","timeOnBoardDataVersion",null).then(function(dataVersion){1!==dataVersion&&(localTimesByBoard={});for(var i=Object.keys(timesByBoard).length-1;i>=0;i--){var boardId=Object.keys(timesByBoard)[i];localTimesByBoard[boardId]||(localTimesByBoard[boardId]={});for(var j=Object.keys(timesByBoard[boardId]).length-1;j>=0;j--){var enteredTime=Object.keys(timesByBoard[boardId])[j];localTimesByBoard[boardId][enteredTime]||(localTimesByBoard[boardId][enteredTime]=timesByBoard[boardId][enteredTime])}}var toSet={};return toSet.timesOnBoardCardId=cardId,toSet.timeOnBoard=localTimesByBoard,toSet.timeOnBoardDataVersion=1,t.set(cardId,"shared",toSet)})},getCardTimeOnBoard=function(cardId,boardId,t){return getCardTimeFromPowerupData$1(t,cardId).then(function(cardTimesByBoard){return cardTimesByBoard&&getLatestBoardEntry(cardTimesByBoard)[boardId]?getLatestBoardEntry(cardTimesByBoard):getStatus(t).then(function(status){return status&&status.boardTracked&&(status.subscriptionActive||status.trialActive)?getCardTimeFromServer$1(cardId,boardId).then(function(response){return response&&response.loaded?(asyncSaveCardTimeOnBoard(t,cardId,response.cardTimesByBoard),getLatestBoardEntry(response.cardTimesByBoard)):void 0}).catch(function(e){bugsnagClient.notify(e)}):void 0})}).then(function(cardTimeEnteredBoard){return t.get("board","shared","weekendMode","SHOW").then(function(weekendMode){return cardTimeEnteredBoard&&cardTimeEnteredBoard[boardId]?getDuration(cardTimeEnteredBoard[boardId],(new Date).getTime(),weekendMode):null})}).catch(function(e){bugsnagClient.notify(e)})},Promise$3=TrelloPowerUp.Promise,getTimeOnBoardBadge=function(t,card){var boardId=t.getContext().board;return{dynamic:function(t){return getCardTimeOnBoard(card.id,boardId,t).then(function(time){var text="refreshing...";return time&&(text=formatTime(time)),{title:"Time On Board",text:text,refresh:10,icon:"./images/days-on-board.svg"}}).then(function(badge){return getStatus(t).then(function(status){return status&&status.boardTracked&&(status.subscriptionActive||status.trialActive)?badge:{refresh:10}})}).catch(function(e){bugsnagClient.notify(e)})}}},getTimeInListBadge=function(t){var boardId=t.getContext().board;return{dynamic:function(t){return t.card("id","idList").then(function(card){return getCardTimeInList(card.id,card.idList,boardId,t).then(function(time){var text="refreshing...";return time&&(text=formatTime(time)),{title:"Time In list",text:text,refresh:10,icon:"./images/days-in-list.svg",color:void 0}}).then(function(badge){return getStatus(t).then(function(status){return status&&status.boardTracked&&(status.subscriptionActive||status.trialActive)?badge:{refresh:10}})}).catch(function(e){bugsnagClient.notify(e)})})}}},getCardBadges=function(t,isCardDetail){var p_board=t.get("board","shared","lists_ignored"),p_showBoardTime=t.get("board","shared","showTimeOnBoard"),p_card=t.card("id","idList");return Promise$3.props({card:p_card,listsIgnored:p_board,showTimeOnBoard:p_showBoardTime}).then(function(_ref){var card=_ref.card,listsIgnored=_ref.listsIgnored,showTimeOnBoard=_ref.showTimeOnBoard,ret=[],timeInListBadge=getTimeInListBadge(t);return listsIgnored&&listsIgnored[card.idList]?isCardDetail||(timeInListBadge.dynamic(t),ret.push({refresh:60})):(ret.push(timeInListBadge),showTimeOnBoard&&ret.push(getTimeOnBoardBadge(t,card))),ret}).catch(function(e){bugsnagClient.notify(e)})},usersWithAdmin=["5b2baf1b6f09ff603a478ec7","4e8eb47da16fe58f9dbdf7d0","6287857aa27fd63f43547155","5a0ecf747b36ab62bf438245","56d024c1728f5af2a64e2d83"],getTrialButtonText=function(status){var cta=status.loggedIn?" - click to subscribe":"";return status.trialActive?formatTime(new Date(status.trialEnds)-new Date)+" remaining on your trial"+cta:"TRIAL EXPIRED"+cta},BUTTONS={admin:{shouldShow:function(status,t){var memberId=t.getContext().member;return usersWithAdmin.includes(memberId)},button:function(){return{text:"Admin",callback:function(t){var loadAdminPage=function(jwt,page){t.modal({url:SERVER_URL+"/Admin"+page+"?jwt="+jwt,title:"Admin",height:600,fullscreen:!0})},addAdminButton=function(jwt,title,page){return{text:title,callback:function(){loadAdminPage(jwt,page)}}};if(t.isMemberSignedIn())return t.jwt().then(function(jwt){return t.popup({title:"Admin",items:[{text:"Open external",callback:function(){window.open("/Admin/stats?jwt="+jwt,"_blank")}},addAdminButton(jwt,"Stats","/stats")]})})}}}},trialStatus:{shouldShow:function(status){return status.accountExists&&!status.subscriptionActive},button:function(status){return{text:getTrialButtonText(status),callback:function(t){status.loggedIn&&t.jwt().then(function(jwt){t.modal({url:SERVER_URL+"/Account/settings?billing=1&boardId="+t.getContext().board+"&jwt="+jwt,title:"Settings - Time In List",height:600})})}}}},showEnable:{shouldShow:function(status){return status.loggedIn&&!status.boardTracked},button:function(){return{text:"Track times for this board",callback:function(t){t.jwt().then(function(jwt){t.modal({url:SERVER_URL+"/Account/enableForBoard?jwt="+jwt,title:"Enable for this board",height:464})})}}}},reconnect:{shouldShow:function(status){return!status.loggedIn&&status.hasAccount},button:function(){return{text:"Please click to reconnect",callback:function(t){t.modal({url:SERVER_URL+"/Authorisation/reconnect",title:"Reconnect",height:464})}}}},charts:{shouldShow:function(status){return status.accountExists&&(status.trialActive||status.subscriptionActive)&&status.boardTracked},button:function(){return{text:"Charts",callback:function(t){t.modal({url:SERVER_URL+"/Charts/charts",title:"Charts - Time In List",fullscreen:!0})}}}},settings:{shouldShow:function(status){return status.accountExists&&status.boardTracked},button:function(){return{text:"Settings",callback:function(t){t.jwt().then(function(jwt){t.modal({url:SERVER_URL+"/Account/settings?boardId="+t.getContext().board+"&launchedFromBoardButton=true&jwt="+jwt,title:"Settings - Time In List",height:464})})}}}},export:{shouldShow:function(status){return status.accountExists&&(status.trialActive||status.subscriptionActive)&&status.boardTracked},button:function(){return{text:"Export",callback:function(t){t.modal({url:SERVER_URL+"/Export/export",title:"Data Export - Time In List",height:670})}}}},signup:{shouldShow:function(status){return!status.accountExists},button:function(){return{text:"Connect to Trello to get started",callback:function(t){t.modal({url:SERVER_URL+"/Signup/start",title:"Enable Time In List",height:464})}}}}},addButton=function(buttonDef,status,items,t){buttonDef.shouldShow(status,t)&&items.push(buttonDef.button(status))},showBoardMenu=function(t){return getStatus(t).then(function(status){var items=Object.keys(BUTTONS).reduce(function(items,button){return addButton(BUTTONS[button],status,items,t),items},[]);t.popup({title:"Time In list",items:items})}).catch(function(e){bugsnagClient.notify(e)})},_onEnable=function(t){return t.jwt().then(function(jwt){t.modal({url:SERVER_URL+"/Signup/start?jwt="+jwt,title:"Enable Time In List",fullscreen:!0})})},_onDisable=function(t){return t.jwt().then(function(jwt){var params={boardId:t.getContext().board,track:"false",jwt:jwt},encodedParams=params&&encodeParams(params),req=new XMLHttpRequest;req.open("POST",SERVER_URL+"/Account/trackBoard",!0),req.setRequestHeader("Content-type","application/x-www-form-urlencoded"),req.send(encodedParams)})};TrelloPowerUp.initialize({"on-enable":function(t){return _onEnable(t)},"on-disable":function(t){return _onDisable(t)},"card-badges":function(t){return getCardBadges(t,!1)},"card-detail-badges":function(t){return getCardBadges(t,!0)},"card-back-section":function(t){return{title:"Card time by list",icon:"./images/logo-grey.png",content:{type:"iframe",url:t.signUrl("./show-card-time-by-list.html"),height:50}}},"board-buttons":function(t){return[!1,{icon:"./images/logo-white.png",text:"Time In List",callback:showBoardMenu}]},"show-settings":function(t){t.jwt().then(function(jwt){t.modal({title:"Time In List Settings",url:SERVER_URL+"/Account/settings?boardId="+t.getContext().board+"&jwt="+jwt,height:220,callback:function(){}})})},"list-actions":function(t){return getStatus(t).then(function(status){return status.loggedIn&&status.boardTracked?t.get("board","shared","lists_ignored").then(function(listsIgnored){var ignored=listsIgnored&&listsIgnored[t.getContext().list];return{text:ignored?"Track Time In List":"Stop tracking Time In List",callback:function(t){listsIgnored||(listsIgnored={}),listsIgnored[t.getContext().list]=!ignored,t.set("board","shared","lists_ignored",listsIgnored),t.closePopup()}}}):{}})}})}();
//# sourceMappingURL=powerup.js.map
